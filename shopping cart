using System.Collections.Generic;
using System.Linq;
using Moq;
using Xunit;

public class Product
{
    public int ProductId { get; set; }
    public string Name { get; set; }
    public decimal Price { get; set; }
    // ... other properties
}


public interface IProductRepository
{
    Product GetProductById(int productId);
}

public class ShoppingCart
{
    private readonly IProductRepository _productRepository;
    private readonly List<Product> _cartItems;

    public ShoppingCart(IProductRepository productRepository)
    {
        _productRepository = productRepository;
        _cartItems = new List<Product>();
    }

    public void AddToCart(int productId)
    {
        var product = _productRepository.GetProductById(productId);
        if (product != null)
        {
            _cartItems.Add(product);
        }
    }

    public decimal CalculateTotal()
    {
        return _cartItems.Sum(item => item.Price);
    }
}

public class ShoppingCartTests
{
    private readonly Mock<IProductRepository> _mockProductRepository;
    private readonly ShoppingCart _shoppingCart;

    public ShoppingCartTests()
    {
        _mockProductRepository = new Mock<IProductRepository>();
        _shoppingCart = new ShoppingCart(_mockProductRepository.Object);
    }

    [Fact]
    public void AddToCart_ProductExists_AddsProductToCart()
    {
        // Arrange
        var product = new Product { ProductId = 1, Name = "Test Product", Price = 10.0m };
        _mockProductRepository.Setup(repo => repo.GetProductById(1)).Returns(product);

        // Act
        _shoppingCart.AddToCart(1);

        // Assert
        var total = _shoppingCart.CalculateTotal();
        Assert.Equal(10.0m, total);
    }

    [Fact]
    public void AddToCart_ProductDoesNotExist_DoesNotAddProductToCart()
    {
        // Arrange
        _mockProductRepository.Setup(repo => repo.GetProductById(1)).Returns((Product)null);

        // Act
        _shoppingCart.AddToCart(1);

        // Assert
        var total = _shoppingCart.CalculateTotal();
        Assert.Equal(0.0m, total);
    }

    [Fact]
    public void CalculateTotal_MultipleProducts_ReturnsCorrectTotal()
    {
        // Arrange
        var product1 = new Product { ProductId = 1, Name = "Product 1", Price = 10.0m };
        var product2 = new Product { ProductId = 2, Name = "Product 2", Price = 20.0m };

        _mockProductRepository.Setup(repo => repo.GetProductById(1)).Returns(product1);
        _mockProductRepository.Setup(repo => repo.GetProductById(2)).Returns(product2);

        _shoppingCart.AddToCart(1);
        _shoppingCart.AddToCart(2);

        // Act
        var total = _shoppingCart.CalculateTotal();

        // Assert
        Assert.Equal(30.0m, total);
    }
}
